#!/usr/bin/env bash

# Simple repo lister with fzf
set -e

# Check if required tools exist
for cmd in gh fzf jq; do
    if ! command -v "$cmd" >/dev/null 2>&1; then
        echo "Error: $cmd is required but not installed." >&2
        exit 1
    fi
done

# Check GitHub auth
if ! gh auth status >/dev/null 2>&1; then
    echo "Please authenticate with GitHub CLI: gh auth login" >&2
    exit 1
fi

echo "Fetching your repositories..." >&2

# Get repos and show in fzf
gh repo list --limit 1000 --json nameWithOwner,description,isPrivate | \
jq -r '.[] | "\(.nameWithOwner) \(if .isPrivate then "[PRIVATE]" else "[PUBLIC]" end) - \(if .description == "" or .description == null then "No description" else .description end)"' | \
fzf --height=80% \
    --layout=reverse \
    --prompt="Select repo: " \
    --header="Use arrows to navigate, type to filter, Enter to select" \
    --preview='echo {} | cut -d" " -f1 | xargs gh repo view' \
    --preview-window=right:60%:wrap
